{% extends "core/base_simple.html" %}

{% block title %}Workstation - Skye OS{% endblock %}

{% block sidebar %}
<h3>Workstation Hub</h3>
<p>Operational data management workspace</p>

<h4>Data Management</h4>
<ul>
    <li><a href="#application-responses">üìù Application Responses <span class="badge">{{ application_responses|length }}</span></a></li>
    <li><a href="#orders">üìã Orders <span class="badge">Coming Soon</span></a></li>
    <li><a href="#applications">üì± Applications <span class="badge">Coming Soon</span></a></li>
</ul>

<h4>Company Management</h4>
<ul>
    <li><a href="#options">‚öôÔ∏è Options <span class="badge">{{ options|length }}</span></a></li>
    <li><a href="#companies">üè¢ Companies <span class="badge">{{ companies|length }}</span></a></li>
    <li><a href="#company-locations">üìç Company Locations <span class="badge">{{ company_locations|length }}</span></a></li>
    <li><a href="#company-contacts">üë• Company Contacts <span class="badge">{{ company_contacts|length }}</span></a></li>
    <li><a href="#company-aliases">üè∑Ô∏è Company Aliases <span class="badge">{{ company_aliases|length }}</span></a></li>
</ul>

<h4>Management Tools</h4>
<ul>
    <li><a href="{% url 'core:catalog' %}">üìä View Catalog</a></li>
    <li><a href="{% url 'core:machine_learning' %}">ü§ñ Machine Learning</a></li>
    <li><a href="#" onclick="alert('Reports coming soon')">üìà Reports</a></li>
    <li><a href="#" onclick="alert('Analytics coming soon')">üìä Analytics</a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="{% url 'core:application_response_list' %}">View All Responses</a></li>
    <li><a href="{% url 'core:options_list' %}">View All Options</a></li>
    <li><a href="{% url 'core:company_list' %}">View All Companies</a></li>
    <li><a href="{% url 'core:company_contact_list' %}">View All Contacts</a></li>
</ul>
{% endblock %}

{% block page_title %}Workstation Hub{% endblock %}
{% block page_subtitle %}Operational data management and workflow processing center{% endblock %}

{% block content %}
{{ block.super }}

<!-- Enhanced Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ application_responses|length }}</div>
        <div>Application Responses</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_companies }}</div>
        <div>Companies</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_contacts }}</div>
        <div>Company Contacts</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_locations }}</div>
        <div>Company Locations</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_options }}</div>
        <div>Options</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_aliases }}</div>
        <div>Company Aliases</div>
    </div>
</div>

<!-- Enhanced Search Bar -->
<div class="card">
    <h3>üîç Search Workstation Data</h3>
    <input type="text" id="globalSearch" placeholder="Search across all workstation data..." style="width: 400px; padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button class="btn" onclick="performGlobalSearch()">Search</button>
    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
</div>

<!-- Application Responses Section -->
<div id="application-responses" class="card">
    <h2>üìù Application Responses</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:application_response_list' %}" class="btn">View All Responses</a>
        <button class="btn" onclick="alert('Add response functionality coming soon')">Add Response</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Response ID</th>
                    <th>Application</th>
                    <th>Question</th>
                    <th>Order</th>
                    <th>Response</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for response in application_responses %}
                <tr>
                    <td>{{ response.application_response_id }}</td>
                    <td>
                        {% if response.application %}
                            <a href="{% url 'core:application_detail' response.application.application_id %}">
                                <strong>{{ response.application.application_name|default:"Unnamed Application"|truncatechars:20 }}</strong>
                            </a>
                        {% else %}
                            <span style="color: #999;">No Application</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if response.application_question %}
                            <span style="color: #666;" title="{{ response.application_question.custom_question }}">
                                {{ response.application_question.custom_question|default:"No Question"|truncatechars:30 }}
                            </span>
                        {% else %}
                            <span style="color: #999;">No Question</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if response.order %}
                            <a href="#" onclick="alert('Order details: {{ response.order.orders_id }}')">
                                <span style="color: #7c3aed;">Order {{ response.order.orders_id }}</span>
                            </a>
                        {% else %}
                            <span style="color: #999;">No Order</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="color: #374151;" title="{{ response.response }}">
                            {{ response.response|default:"No Response"|truncatechars:40 }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'core:application_response_detail' response.application_response_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No application responses found in the database.</p>
                        <button class="btn">Add Response</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ application_responses|length }} application responses
        {% if application_responses|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:application_response_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Options Section -->
<div id="options" class="card">
    <h2>‚öôÔ∏è Options</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:options_list' %}" class="btn">View All Options</a>
        <button class="btn" onclick="alert('Add option functionality coming soon')">Add Option</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Option ID</th>
                    <th>Option Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for option in options %}
                <tr>
                    <td>{{ option.options_id }}</td>
                    <td>
                        <a href="{% url 'core:options_detail' option.options_id %}">
                            <strong>{{ option.option_name|default:"Unnamed Option" }}</strong>
                        </a>
                    </td>
                    <td>
                        <a href="{% url 'core:options_detail' option.options_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">
                        <p>No options found in the database.</p>
                        <button class="btn">Add Option</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ total_options }} options
        {% if options|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:options_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Companies Section -->
<div id="companies" class="card">
    <h2>üè¢ Companies</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:company_list' %}" class="btn">View All Companies</a>
        <button class="btn" onclick="alert('Add company functionality coming soon')">Add Company</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Company ID</th>
                    <th>Company Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for company in companies %}
                <tr>
                    <td>{{ company.company_id }}</td>
                    <td>
                        <a href="{% url 'core:company_detail' company.company_id %}">
                            <strong>{{ company.company_name|default:"Unnamed Company" }}</strong>
                        </a>
                    </td>
                    <td>
                        <a href="{% url 'core:company_detail' company.company_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">
                        <p>No companies found in the database.</p>
                        <button class="btn">Add Company</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ total_companies }} companies
        {% if companies|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:company_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Company Locations Section -->
<div id="company-locations" class="card">
    <h2>üìç Company Locations</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:company_location_list' %}" class="btn">View All Locations</a>
        <button class="btn" onclick="alert('Add location functionality coming soon')">Add Location</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Location ID</th>
                    <th>Company</th>
                    <th>City, State</th>
                    <th>Address</th>
                    <th>Mailing</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for location in company_locations %}
                <tr>
                    <td>{{ location.company_location_id }}</td>
                    <td>
                        {% if location.company %}
                            <a href="{% url 'core:company_detail' location.company.company_id %}">
                                {{ location.company.company_name|default:"Unnamed Company"|truncatechars:20 }}
                            </a>
                        {% else %}
                            <span style="color: #999;">No Company</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if location.company_location_city and location.company_location_state %}
                            {{ location.company_location_city }}, {{ location.company_location_state }}
                        {% else %}
                            <span style="color: #999;">Not specified</span>
                        {% endif %}
                    </td>
                    <td>{{ location.company_location_address_1|truncatechars:30|default:"No address" }}</td>
                    <td>
                        {% if location.company_mailing %}
                            <span style="color: #059669;">‚úì Mailing</span>
                        {% else %}
                            <span style="color: #999;">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:company_location_detail' location.company_location_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No company locations found in the database.</p>
                        <button class="btn">Add Location</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ total_locations }} company locations
        {% if company_locations|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:company_location_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Company Contacts Section -->
<div id="company-contacts" class="card">
    <h2>üë• Company Contacts</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:company_contact_list' %}" class="btn">View All Contacts</a>
        <button class="btn" onclick="alert('Add contact functionality coming soon')">Add Contact</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Contact ID</th>
                    <th>Company</th>
                    <th>Name</th>
                    <th>Title</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for contact in company_contacts %}
                <tr>
                    <td>{{ contact.company_contact_id }}</td>
                    <td>
                        {% if contact.company %}
                            <a href="{% url 'core:company_detail' contact.company.company_id %}">
                                {{ contact.company.company_name|default:"Unnamed Company"|truncatechars:15 }}
                            </a>
                        {% else %}
                            <span style="color: #999;">No Company</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:company_contact_detail' contact.company_contact_id %}">
                            <strong>
                                {% if contact.company_contact_first or contact.company_contact_last %}
                                    {{ contact.company_contact_first|default:"" }} {{ contact.company_contact_last|default:"" }}
                                {% else %}
                                    Contact {{ contact.company_contact_id }}
                                {% endif %}
                            </strong>
                        </a>
                    </td>
                    <td>{{ contact.company_contact_title|default:"No title"|truncatechars:20 }}</td>
                    <td>
                        {% if contact.company_contact_email %}
                            <a href="mailto:{{ contact.company_contact_email }}">{{ contact.company_contact_email|truncatechars:25 }}</a>
                        {% else %}
                            <span style="color: #999;">No email</span>
                        {% endif %}
                    </td>
                    <td>{{ contact.company_contact_phone|default:"No phone" }}</td>
                    <td>
                        <a href="{% url 'core:company_contact_detail' contact.company_contact_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">
                        <p>No company contacts found in the database.</p>
                        <button class="btn">Add Contact</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ total_contacts }} company contacts
        {% if company_contacts|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:company_contact_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Company Aliases Section -->
<div id="company-aliases" class="card">
    <h2>üè∑Ô∏è Company Aliases</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:company_alias_list' %}" class="btn">View All Aliases</a>
        <button class="btn" onclick="alert('Add alias functionality coming soon')">Add Alias</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Alias ID</th>
                    <th>Company</th>
                    <th>Alias Name</th>
                    <th>Effective Date</th>
                    <th>Expiration Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for alias in company_aliases %}
                <tr>
                    <td>{{ alias.company_alias_id }}</td>
                    <td>
                        {% if alias.company %}
                            <a href="{% url 'core:company_detail' alias.company.company_id %}">
                                {{ alias.company.company_name|default:"Unnamed Company"|truncatechars:20 }}
                            </a>
                        {% else %}
                            <span style="color: #999;">No Company</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:company_alias_detail' alias.company_alias_id %}">
                            <strong>{{ alias.company_alias_name|default:"Unnamed Alias" }}</strong>
                        </a>
                    </td>
                    <td>
                        {% if alias.company_alias_eff_dte %}
                            {{ alias.company_alias_eff_dte|date:"M d, Y" }}
                        {% else %}
                            <span style="color: #999;">No date</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if alias.company_alias_exp_dte %}
                            {{ alias.company_alias_exp_dte|date:"M d, Y" }}
                        {% else %}
                            <span style="color: #999;">No expiration</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:company_alias_detail' alias.company_alias_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No company aliases found in the database.</p>
                        <button class="btn">Add Alias</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ total_aliases }} company aliases
        {% if company_aliases|length >= 20 %}
            (showing first 20 - <a href="{% url 'core:company_alias_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Future Orders Section (Placeholder) -->
<div id="orders" class="card">
    <h2>üìã Orders</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn btn-secondary" disabled>Coming Soon</button>
    </div>
    <p style="color: #666; text-align: center; padding: 40px;">
        Orders management section will be added next. This will show order data from your PostgreSQL database.
    </p>
</div>

<!-- Future Applications Section (Placeholder) -->
<div id="applications" class="card">
    <h2>üì± Applications</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn btn-secondary" disabled>Coming Soon</button>
    </div>
    <p style="color: #666; text-align: center; padding: 40px;">
        Applications management section will be added next. This will show application data from your PostgreSQL database.
    </p>
</div>

<script>
// Enhanced search functionality (same as catalog)
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) {
        alert('Please enter a search term');
        return;
    }
    
    const allRows = document.querySelectorAll('tbody tr');
    let hasResults = false;
    
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
            // Highlight the section
            const section = row.closest('.card');
            if (section) {
                section.style.border = '2px solid #007bff';
                setTimeout(() => {
                    section.style.border = '1px solid #ddd';
                }, 3000);
            }
        } else {
            row.style.display = 'none';
        }
    });
    
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        clearSearch();
    }
}

function clearSearch() {
    document.getElementById('globalSearch').value = '';
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = '');
    
    // Reset section borders
    document.querySelectorAll('.card').forEach(card => {
        card.style.border = '1px solid #ddd';
    });
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Simple smooth scrolling for anchor links (same as catalog)
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
            // Add a brief highlight effect
            target.style.background = '#f0f8ff';
            setTimeout(() => {
                target.style.background = '';
            }, 2000);
        }
    });
});

console.log('Workstation loaded with {{ application_responses|length }} application responses and {{ total_companies }} companies');
</script>
{% endblock %}