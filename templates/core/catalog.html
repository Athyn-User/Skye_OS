{% extends "core/base_simple.html" %}

{% block title %}Catalog - Skye OS{% endblock %}

{% block sidebar %}
<h3>Enterprise Catalog</h3>
<p>Complete directory of all resources</p>

<h4>Infrastructure</h4>
<ul>
    <li><a href="#ventures">üè¢ Ventures <span class="badge">{{ ventures|length }}</span></a></li>
    <li><a href="#drives">üíæ Storage Drives <span class="badge">{{ drives|length }}</span></a></li>
    <li><a href="#employee-locations">üìç Employee Locations <span class="badge">{{ employee_locations|length }}</span></a></li>
</ul>

<h4>Business Operations</h4>
<ul>
    <li><a href="#products">üõçÔ∏è Products <span class="badge">{{ products|length }}</span></a></li>
    <li><a href="#coverage-types">üõ°Ô∏è Coverage Types <span class="badge">{{ coverage_types|length }}</span></a></li>
</ul>

<h4>Human Resources</h4>
<ul>
    <li><a href="#employee-contacts">üë• Employee Contacts <span class="badge">{{ employee_contacts|length }}</span></a></li>
    <li><a href="#employee-functions">‚öôÔ∏è Employee Functions <span class="badge">{{ employee_functions|length }}</span></a></li>
</ul>

<h4>Management</h4>
<ul>
    <li><a href="{% url 'core:machine_learning' %}">ü§ñ Machine Learning</a></li>
    <li><a href="#" onclick="alert('Coming soon')">üìä Reports</a></li>
    <li><a href="#" onclick="alert('Coming soon')">‚≠ê Analytics</a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="{% url 'core:products_list' %}">View All Products</a></li>
    <li><a href="{% url 'core:employee_contact_list' %}">Employee Directory</a></li>
    <li><a href="{% url 'core:cover_list' %}">Coverage Management</a></li>
</ul>
{% endblock %}

{% block page_title %}Enterprise Catalog{% endblock %}
{% block page_subtitle %}Complete directory of ventures, products, employees, and business resources{% endblock %}

{% block content %}
{{ block.super }}

<!-- Enhanced Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ ventures|length }}</div>
        <div>Active Ventures</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ products|length }}</div>
        <div>Products</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ employee_contacts|length }}</div>
        <div>Employees</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ drives|length }}</div>
        <div>Storage Drives</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ coverage_types|length }}</div>
        <div>Coverage Types</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ employee_functions|length }}</div>
        <div>Job Functions</div>
    </div>
</div>

<!-- Enhanced Search Bar -->
<div class="card">
    <h3>üîç Search Across All Catalog Items</h3>
    <input type="text" id="globalSearch" placeholder="Search ventures, products, employees, coverage..." style="width: 400px; padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button class="btn" onclick="performGlobalSearch()">Search</button>
    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
</div>

<!-- Ventures Section -->
<div id="ventures" class="card">
    <h2>üè¢ Business Ventures</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:catalog' %}" class="btn">Refresh</a>
        <button class="btn" onclick="alert('Export functionality coming soon')">Export</button>
        <a href="{% url 'core:venture_api' %}" class="btn btn-secondary">API</a>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Venture ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for venture in ventures %}
            <tr>
                <td>{{ venture.venture_id }}</td>
                <td>
                    <strong>{{ venture.venture_name|default:"Unnamed Venture" }}</strong>
                </td>
                <td>
                    {% if venture.venture_city and venture.venture_state %}
                        {{ venture.venture_city }}, {{ venture.venture_state }}
                    {% else %}
                        Not specified
                    {% endif %}
                </td>
                <td>{{ venture.venture_address_1|truncatechars:30|default:"No address" }}</td>
                <td>
                    <span style="color: green;">‚úÖ Active</span>
                </td>
                <td>
                    <a href="#" onclick="alert('View venture {{ venture.venture_id }}')">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <p>No ventures found. Start by adding your first business venture.</p>
                    <button class="btn">Add Venture</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Products Section - SHOWING ALL PRODUCTS -->

<!-- DEBUG Products Section - Add this ABOVE the existing Products section -->
<div class="card" style="background: #ffeeee; border: 2px solid red;">
    <h2>üîç DEBUG: Products Information</h2>
    <p><strong>Products variable exists:</strong> {% if products %}YES{% else %}NO{% endif %}</p>
    <p><strong>Products count:</strong> {{ products|length }}</p>
    <p><strong>Products type:</strong> {{ products|default:"None" }}</p>
    
    {% if products %}
        <p><strong>First 3 products:</strong></p>
        <ul>
            {% for product in products|slice:":3" %}
                <li>ID: {{ product.products_id }} - Name: {{ product.product_name|default:"No name" }}</li>
            {% empty %}
                <li>Products exist but loop is empty?</li>
            {% endfor %}
        </ul>
    {% else %}
        <p style="color: red;"><strong>Products variable is empty or None!</strong></p>
    {% endif %}
</div>

<div id="products" class="card">
    <h2>üõçÔ∏è Products Catalog</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:products_list' %}" class="btn">View All Products</a>
        <button class="btn" onclick="alert('Add product functionality coming soon')">Add Product</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Product Name</th>
                    <th>Code</th>
                    <th>Venture</th>
                    <th>Coverage</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>{{ product.products_id }}</td>
                    <td>
                        <a href="{% url 'core:products_detail' product.products_id %}">
                            <strong>{{ product.product_name|default:"Unnamed Product" }}</strong>
                        </a>
                    </td>
                    <td>
                        {% if product.product_code %}
                            <code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px;">{{ product.product_code }}</code>
                        {% else %}
                            <span style="color: #999;">No code</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if product.venture %}
                            {{ product.venture.venture_name|default:"Unnamed Venture"|truncatechars:20 }}
                        {% else %}
                            <span style="color: #999;">No venture</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if product.coverage %}
                            {{ product.coverage.coverage_name|default:"Coverage"|truncatechars:15 }}
                        {% else %}
                            <span style="color: #999;">No coverage</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:products_detail' product.products_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No products found. Add products to your catalog.</p>
                        <button class="btn">Add Product</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ products|length }} products
    </p>
</div>

<!-- Coverage Types Section - SHOWING ALL COVERAGE -->
<div id="coverage-types" class="card">
    <h2>üõ°Ô∏è Coverage Types</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:cover_list' %}" class="btn">View All Coverage</a>
        <button class="btn" onclick="alert('Add coverage functionality coming soon')">Add Coverage</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Cover ID</th>
                    <th>Coverage Name</th>
                    <th>Associated Product</th>
                    <th>Product Code</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cover in coverage_types %}
                <tr>
                    <td>{{ cover.cover_id }}</td>
                    <td>
                        <a href="{% url 'core:cover_detail' cover.cover_id %}">
                            <strong>{{ cover.cover_name|default:"Unnamed Coverage" }}</strong>
                        </a>
                    </td>
                    <td>
                        {% if cover.product %}
                            <a href="{% url 'core:products_detail' cover.product.products_id %}">
                                {{ cover.product.product_name|default:"Unnamed Product"|truncatechars:25 }}
                            </a>
                        {% else %}
                            <span style="color: #999;">No product</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if cover.product and cover.product.product_code %}
                            <code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px;">{{ cover.product.product_code }}</code>
                        {% else %}
                            <span style="color: #999;">No code</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:cover_detail' cover.cover_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">
                        <p>No coverage types found. Add coverage types to your catalog.</p>
                        <button class="btn">Add Coverage</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ coverage_types|length }} coverage types
    </p>
</div>

<!-- Employee Contacts Section - SHOWING ALL EMPLOYEES -->
<div id="employee-contacts" class="card">
    <h2>üë• Employee Directory</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:employee_contact_list' %}" class="btn">Full Directory</a>
        <button class="btn" onclick="alert('Add employee functionality coming soon')">Add Employee</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Employee ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Location</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employee_contacts %}
                <tr>
                    <td>{{ employee.employee_id }}</td>
                    <td>
                        <a href="{% url 'core:employee_contact_detail' employee.employee_id %}">
                            <strong>
                                {% if employee.employee_name_first or employee.employee_name_last %}
                                    {{ employee.employee_name_first|default:"" }} {{ employee.employee_name_last|default:"" }}
                                {% else %}
                                    Employee {{ employee.employee_id }}
                                {% endif %}
                            </strong>
                        </a>
                    </td>
                    <td>
                        {% if employee.employee_email %}
                            <a href="mailto:{{ employee.employee_email }}">{{ employee.employee_email|truncatechars:30 }}</a>
                        {% else %}
                            <span style="color: #999;">No email</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if employee.employee_location %}
                            {{ employee.employee_location.employee_location_name|default:"Location"|truncatechars:20 }}
                        {% else %}
                            <span style="color: #999;">No location</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:employee_contact_detail' employee.employee_id %}">View Profile</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">
                        <p>No employee contacts found. Add employees to your directory.</p>
                        <button class="btn">Add Employee</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ employee_contacts|length }} employees
    </p>
</div>

<!-- Employee Functions Section - SHOWING ALL FUNCTIONS -->
<div id="employee-functions" class="card">
    <h2>‚öôÔ∏è Employee Functions</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:employee_function_list' %}" class="btn">View All Functions</a>
        <button class="btn" onclick="alert('Add function functionality coming soon')">Add Function</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Function ID</th>
                    <th>Function Name</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for function in employee_functions %}
                <tr>
                    <td>{{ function.employee_function_id }}</td>
                    <td>
                        <a href="{% url 'core:employee_function_detail' function.employee_function_id %}">
                            <strong>{{ function.employee_function|default:"Unnamed Function" }}</strong>
                        </a>
                    </td>
                    <td>
                        <span style="color: #666; font-style: italic;">
                            {% if function.employee_function %}
                                {{ function.employee_function|truncatechars:50 }}
                            {% else %}
                                No description available
                            {% endif %}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'core:employee_function_detail' function.employee_function_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">
                        <p>No employee functions found. Add job functions to organize roles.</p>
                        <button class="btn">Add Function</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ employee_functions|length }} functions
    </p>
</div>

<!-- Storage Drives Section -->
<div id="drives" class="card">
    <h2>üíæ Storage Drives</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn" onclick="alert('Storage analysis coming soon')">Analyze</button>
        <button class="btn" onclick="alert('Add drive functionality coming soon')">Add Drive</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Drive ID</th>
                    <th>Drive Name</th>
                    <th>Associated Venture</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for drive in drives %}
                <tr>
                    <td>{{ drive.drive_id }}</td>
                    <td>
                        <strong>{{ drive.drive_name|default:"Unnamed Drive" }}</strong>
                    </td>
                    <td>
                        {% if drive.venture %}
                            <a href="#ventures">{{ drive.venture.venture_name|default:"Unnamed Venture" }}</a>
                        {% else %}
                            No venture assigned
                        {% endif %}
                    </td>
                    <td>Storage</td>
                    <td>
                        <span style="color: green;">‚úÖ Online</span>
                    </td>
                    <td>
                        <a href="#" onclick="alert('Manage drive {{ drive.drive_id }}')">Manage</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No storage drives found. Add drives to organize your data.</p>
                        <button class="btn">Add Drive</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ drives|length }} drives
    </p>
</div>

<!-- Employee Locations Section -->
<div id="employee-locations" class="card">
    <h2>üìç Employee Locations</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn" onclick="alert('Map view coming soon')">View Map</button>
        <button class="btn" onclick="alert('Add location functionality coming soon')">Add Location</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Location ID</th>
                    <th>Location Name</th>
                    <th>Venture</th>
                    <th>City & State</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for location in employee_locations %}
                <tr>
                    <td>{{ location.employee_location_id }}</td>
                    <td>
                        <strong>{{ location.employee_location_name|default:"Unnamed Location" }}</strong>
                    </td>
                    <td>
                        {% if location.venture %}
                            <a href="#ventures">{{ location.venture.venture_name|default:"Unnamed Venture" }}</a>
                        {% else %}
                            No venture assigned
                        {% endif %}
                    </td>
                    <td>
                        {% if location.employee_location_city and location.employee_location_state %}
                            {{ location.employee_location_city }}, {{ location.employee_location_state }}
                        {% else %}
                            Not specified
                        {% endif %}
                    </td>
                    <td>{{ location.employee_location_address_1|truncatechars:30|default:"No address" }}</td>
                    <td>
                        <a href="#" onclick="alert('View location {{ location.employee_location_id }}')">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No employee locations found. Add locations to track workforce distribution.</p>
                        <button class="btn">Add Location</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ employee_locations|length }} locations
    </p>
</div>

<script>
// Enhanced search functionality
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) {
        alert('Please enter a search term');
        return;
    }
    
    const allRows = document.querySelectorAll('tbody tr');
    let hasResults = false;
    
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
            // Highlight the section
            const section = row.closest('.card');
            if (section) {
                section.style.border = '2px solid #007bff';
                setTimeout(() => {
                    section.style.border = '1px solid #ddd';
                }, 3000);
            }
        } else {
            row.style.display = 'none';
        }
    });
    
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        clearSearch();
    }
}

function clearSearch() {
    document.getElementById('globalSearch').value = '';
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = '');
    
    // Reset section borders
    document.querySelectorAll('.card').forEach(card => {
        card.style.border = '1px solid #ddd';
    });
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Simple smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
            // Add a brief highlight effect
            target.style.background = '#f0f8ff';
            setTimeout(() => {
                target.style.background = '';
            }, 2000);
        }
    });
});

console.log('Enhanced Catalog loaded with {{ products|length }} products, {{ employee_contacts|length }} employees, {{ coverage_types|length }} coverage types');
</script>
{% endblock %}