{% extends "core/base_simple.html" %}

{% block title %}Workstation - Skye OS{% endblock %}

{% block sidebar %}
<h3>Workstation Hub</h3>
<p>Operational data management workspace</p>

<h4>Data Management</h4>
<ul>
    <li><a href="#application-responses">ğŸ“ Application Responses <span class="badge">{{ application_responses|length }}</span></a></li>
    <li><a href="#orders">ğŸ“‹ Orders <span class="badge">Coming Soon</span></a></li>
    <li><a href="#applications">ğŸ“± Applications <span class="badge">Coming Soon</span></a></li>
</ul>

<h4>Workflow Operations</h4>
<ul>
    <li><a href="#companies">ğŸ¢ Companies <span class="badge">Coming Soon</span></a></li>
    <li><a href="#company-contacts">ğŸ‘¥ Company Contacts <span class="badge">Coming Soon</span></a></li>
    <li><a href="#documents">ğŸ“„ Documents <span class="badge">Coming Soon</span></a></li>
</ul>

<h4>Management Tools</h4>
<ul>
    <li><a href="{% url 'core:catalog' %}">ğŸ“Š View Catalog</a></li>
    <li><a href="{% url 'core:machine_learning' %}">ğŸ¤– Machine Learning</a></li>
    <li><a href="#" onclick="alert('Reports coming soon')">ğŸ“ˆ Reports</a></li>
    <li><a href="#" onclick="alert('Analytics coming soon')">ğŸ“Š Analytics</a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="{% url 'core:application_response_list' %}">View All Responses</a></li>
    <li><a href="{% url 'core:application_list' %}">View All Applications</a></li>
    <li><a href="{% url 'core:application_question_list' %}">View All Questions</a></li>
</ul>
{% endblock %}

{% block page_title %}Workstation Hub{% endblock %}
{% block page_subtitle %}Operational data management and workflow processing center{% endblock %}

{% block content %}
{{ block.super }}

<!-- Enhanced Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ application_responses|length }}</div>
        <div>Application Responses</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ unique_applications }}</div>
        <div>Unique Applications</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ unique_orders }}</div>
        <div>Associated Orders</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_responses }}</div>
        <div>Total Records</div>
    </div>
</div>

<!-- Enhanced Search Bar -->
<div class="card">
    <h3>ğŸ” Search Workstation Data</h3>
    <input type="text" id="globalSearch" placeholder="Search application responses, applications, orders..." style="width: 400px; padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button class="btn" onclick="performGlobalSearch()">Search</button>
    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
</div>

<!-- Application Responses Section -->
<div id="application-responses" class="card">
    <h2>ğŸ“ Application Responses</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:application_response_list' %}" class="btn">View All Responses</a>
        <button class="btn" onclick="alert('Add response functionality coming soon')">Add Response</button>
        <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Response ID</th>
                    <th>Application</th>
                    <th>Question</th>
                    <th>Order</th>
                    <th>Response</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for response in application_responses %}
                <tr>
                    <td>{{ response.application_response_id }}</td>
                    <td>
                        {% if response.application %}
                            <a href="{% url 'core:application_detail' response.application.application_id %}">
                                <strong>{{ response.application.application_name|default:"Unnamed Application"|truncatechars:20 }}</strong>
                            </a>
                        {% else %}
                            <span style="color: #999;">No Application</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if response.application_question %}
                            <span style="color: #666;" title="{{ response.application_question.custom_question }}">
                                {{ response.application_question.custom_question|default:"No Question"|truncatechars:30 }}
                            </span>
                        {% else %}
                            <span style="color: #999;">No Question</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if response.order %}
                            <a href="#" onclick="alert('Order details: {{ response.order.orders_id }}')">
                                <span style="color: #7c3aed;">Order {{ response.order.orders_id }}</span>
                            </a>
                        {% else %}
                            <span style="color: #999;">No Order</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="color: #374151;" title="{{ response.response }}">
                            {{ response.response|default:"No Response"|truncatechars:40 }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'core:application_response_detail' response.application_response_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No application responses found in the database.</p>
                        <button class="btn">Add Response</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ application_responses|length }} application responses
        {% if application_responses|length > 20 %}
            (showing first 20 - <a href="{% url 'core:application_response_list' %}">view all</a>)
        {% endif %}
    </p>
</div>

<!-- Future Orders Section (Placeholder) -->
<div id="orders" class="card">
    <h2>ğŸ“‹ Orders</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn btn-secondary" disabled>Coming Soon</button>
    </div>
    <p style="color: #666; text-align: center; padding: 40px;">
        Orders management section will be added next. This will show order data from your PostgreSQL database.
    </p>
</div>

<!-- Future Applications Section (Placeholder) -->
<div id="applications" class="card">
    <h2>ğŸ“± Applications</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn btn-secondary" disabled>Coming Soon</button>
    </div>
    <p style="color: #666; text-align: center; padding: 40px;">
        Applications management section will be added next. This will show application data from your PostgreSQL database.
    </p>
</div>

<script>
// Enhanced search functionality (same as catalog)
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) {
        alert('Please enter a search term');
        return;
    }
    
    const allRows = document.querySelectorAll('tbody tr');
    let hasResults = false;
    
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
            // Highlight the section
            const section = row.closest('.card');
            if (section) {
                section.style.border = '2px solid #007bff';
                setTimeout(() => {
                    section.style.border = '1px solid #ddd';
                }, 3000);
            }
        } else {
            row.style.display = 'none';
        }
    });
    
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        clearSearch();
    }
}

function clearSearch() {
    document.getElementById('globalSearch').value = '';
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = '');
    
    // Reset section borders
    document.querySelectorAll('.card').forEach(card => {
        card.style.border = '1px solid #ddd';
    });
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Simple smooth scrolling for anchor links (same as catalog)
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
            // Add a brief highlight effect
            target.style.background = '#f0f8ff';
            setTimeout(() => {
                target.style.background = '';
            }, 2000);
        }
    });
});

console.log('Workstation loaded with {{ application_responses|length }} application responses');
</script>
{% endblock %}