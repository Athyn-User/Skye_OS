{% extends "core/base_simple.html" %}

{% block title %}Catalog - Skye OS{% endblock %}

{% block sidebar %}
<h3>Catalog</h3>
<p>Enterprise data and resources</p>

<h4>Infrastructure</h4>
<ul>
    <li><a href="#ventures">üè¢ Ventures <span class="badge">{{ ventures|length }}</span></a></li>
    <li><a href="#drives">üíæ Storage Drives <span class="badge">{{ drives|length }}</span></a></li>
    <li><a href="#employee-locations">üìç Employee Locations <span class="badge">{{ employee_locations|length }}</span></a></li>
</ul>

<h4>Management</h4>
<ul>
    <li><a href="{% url 'core:machine_learning' %}">ü§ñ Machine Learning</a></li>
    <li><a href="#" onclick="alert('Coming soon')">üìä Reports</a></li>
    <li><a href="#" onclick="alert('Coming soon')">‚≠ê Analytics</a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="#ventures">‚ûï Add New Venture</a></li>
    <li><a href="#drives">üíΩ Manage Storage</a></li>
</ul>
{% endblock %}

{% block page_title %}Enterprise Catalog{% endblock %}
{% block page_subtitle %}Manage your ventures, storage drives, and employee locations{% endblock %}

{% block content %}
{{ block.super }}

<!-- Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ ventures|length }}</div>
        <div>Active Ventures</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ drives|length }}</div>
        <div>Storage Drives</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ employee_locations|length }}</div>
        <div>Employee Locations</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">100%</div>
        <div>System Health</div>
    </div>
</div>

<!-- Search Bar -->
<div class="card">
    <input type="text" id="globalSearch" placeholder="Search across all catalog items..." style="width: 300px; padding: 8px; margin-right: 10px;">
    <button class="btn" onclick="performGlobalSearch()">Search</button>
    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
</div>

<!-- Ventures Section -->
<div id="ventures" class="card">
    <h2>üè¢ Business Ventures</h2>
    <button class="btn" onclick="alert('Export functionality coming soon')">Export</button>
    <button class="btn" onclick="alert('Add venture functionality coming soon')">Add Venture</button>
    
    <table>
        <thead>
            <tr>
                <th>Venture ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for venture in ventures %}
            <tr>
                <td>{{ venture.venture_id }}</td>
                <td>
                    <strong>{{ venture.venture_name|default:"Unnamed Venture" }}</strong>
                </td>
                <td>
                    {% if venture.venture_city and venture.venture_state %}
                        {{ venture.venture_city }}, {{ venture.venture_state }}
                    {% else %}
                        Not specified
                    {% endif %}
                </td>
                <td>{{ venture.venture_address_1|truncatechars:30|default:"No address" }}</td>
                <td>
                    <span style="color: green;">‚úÖ Active</span>
                </td>
                <td>
                    <a href="#" onclick="alert('View venture {{ venture.venture_id }}')">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <p>No ventures found. Start by adding your first business venture.</p>
                    <button class="btn">Add Venture</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Storage Drives Section -->
<div id="drives" class="card">
    <h2>üíæ Storage Drives</h2>
    <button class="btn" onclick="alert('Storage analysis coming soon')">Analyze</button>
    <button class="btn" onclick="alert('Add drive functionality coming soon')">Add Drive</button>
    
    <table>
        <thead>
            <tr>
                <th>Drive ID</th>
                <th>Drive Name</th>
                <th>Associated Venture</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for drive in drives %}
            <tr>
                <td>{{ drive.drive_id }}</td>
                <td>
                    <strong>{{ drive.drive_name|default:"Unnamed Drive" }}</strong>
                </td>
                <td>
                    {% if drive.venture %}
                        <a href="#ventures">{{ drive.venture.venture_name|default:"Unnamed Venture" }}</a>
                    {% else %}
                        No venture assigned
                    {% endif %}
                </td>
                <td>Storage</td>
                <td>
                    <span style="color: green;">‚úÖ Online</span>
                </td>
                <td>
                    <a href="#" onclick="alert('Manage drive {{ drive.drive_id }}')">Manage</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <p>No storage drives found. Add drives to organize your data.</p>
                    <button class="btn">Add Drive</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Employee Locations Section -->
<div id="employee-locations" class="card">
    <h2>üìç Employee Locations</h2>
    <button class="btn" onclick="alert('Map view coming soon')">View Map</button>
    <button class="btn" onclick="alert('Add location functionality coming soon')">Add Location</button>
    
    <table>
        <thead>
            <tr>
                <th>Location ID</th>
                <th>Location Name</th>
                <th>Venture</th>
                <th>City & State</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for location in employee_locations %}
            <tr>
                <td>{{ location.employee_location_id }}</td>
                <td>
                    <strong>{{ location.employee_location_name|default:"Unnamed Location" }}</strong>
                </td>
                <td>
                    {% if location.venture %}
                        <a href="#ventures">{{ location.venture.venture_name|default:"Unnamed Venture" }}</a>
                    {% else %}
                        No venture assigned
                    {% endif %}
                </td>
                <td>
                    {% if location.employee_location_city and location.employee_location_state %}
                        {{ location.employee_location_city }}, {{ location.employee_location_state }}
                    {% else %}
                        Not specified
                    {% endif %}
                </td>
                <td>{{ location.employee_location_address_1|truncatechars:30|default:"No address" }}</td>
                <td>
                    <a href="#" onclick="alert('View location {{ location.employee_location_id }}')">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <p>No employee locations found. Add locations to track workforce distribution.</p>
                    <button class="btn">Add Location</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
// Simple search functionality
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) {
        alert('Please enter a search term');
        return;
    }
    
    const allRows = document.querySelectorAll('tbody tr');
    let hasResults = false;
    
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
        } else {
            row.style.display = 'none';
        }
    });
    
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        clearSearch();
    }
}

function clearSearch() {
    document.getElementById('globalSearch').value = '';
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = '');
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Simple smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
        }
    });
});
</script>
{% endblock %}