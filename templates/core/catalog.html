{% extends "core/base_simple.html" %}

{% block title %}Catalog - Skye OS{% endblock %}

{% block sidebar %}
<h3>Enterprise Catalog</h3>
<p>Complete directory of all resources</p>

<h4>Infrastructure</h4>
<ul>
    <li><a href="#ventures">üè¢ Ventures <span class="badge">{{ ventures|length }}</span></a></li>
    <li><a href="#drives">üíæ Storage Drives <span class="badge">{{ drives|length }}</span></a></li>
    <li><a href="#employee-locations">üìç Employee Locations <span class="badge">{{ employee_locations|length }}</span></a></li>
</ul>

<h4>Business Operations</h4>
<ul>
    <li><a href="#products">üõçÔ∏è Products <span class="badge">{{ products|length }}</span></a></li>
    <li><a href="#coverage-types">üõ°Ô∏è Coverage Types <span class="badge">{{ coverage_types|length }}</span></a></li>
</ul>

<h4>Human Resources</h4>
<ul>
    <li><a href="#employee-contacts">üë• Employee Contacts <span class="badge">{{ employee_contacts|length }}</span></a></li>
    <li><a href="#employee-functions">‚öôÔ∏è Employee Functions <span class="badge">{{ employee_functions|length }}</span></a></li>
</ul>

<h4>Management</h4>
<ul>
    <li><a href="{% url 'core:machine_learning' %}">ü§ñ Machine Learning</a></li>
    <li><a href="{% url 'core:workstation' %}">üîß Workstation</a></li>
    <li><a href="#" onclick="alert('Coming soon')">üìä Reports</a></li>
    <li><a href="#" onclick="alert('Coming soon')">‚≠ê Analytics</a></li>
</ul>

<h4>System Configuration</h4>
<ul>
    <li><a href="#parameters">‚öôÔ∏è Parameters <span class="badge">{{ parameters|length }}</span></a></li>
    <li><a href="#parameter-maps">üó∫Ô∏è Parameter Maps <span class="badge">{{ parameter_maps|length }}</span></a></li>
    <li><a href="#documents">üìÑ Documents <span class="badge">{{ documents|length }}</span></a></li>
    <li><a href="#tasks">üìã Tasks <span class="badge">{{ tasks|length }}</span></a></li>
</ul>

<h4>Workflow & Business Logic</h4>
<ul>
    <li><a href="#workflows">‚ö° Workflows <span class="badge">{{ workflows|length }}</span></a></li>
    <li><a href="#workflow-details">üìã Workflow Details <span class="badge">{{ workflow_details|length }}</span></a></li>
    <li><a href="#attachments">üìé Attachments <span class="badge">{{ attachments|length }}</span></a></li>
    <li><a href="#attachment-details">üîó Attachment Details <span class="badge">{{ attachment_details|length }}</span></a></li>
    <li><a href="#limits">üöß Limits <span class="badge">{{ limits|length }}</span></a></li>
    <li><a href="#retentions">üí∞ Retentions <span class="badge">{{ retentions|length }}</span></a></li>
    <li><a href="#sublimits">üìä Sublimits <span class="badge">{{ sublimits|length }}</span></a></li>
</ul>

<h4>Paper & Applications</h4>
<ul>
    <li><a href="#papers">üìÑ Papers <span class="badge">{{ papers|length }}</span></a></li>
    <li><a href="#paper-details">üìä Paper Details <span class="badge">{{ paper_details|length }}</span></a></li>
    <li><a href="#applications">üì± Applications <span class="badge">{{ applications|length }}</span></a></li>
    <li><a href="#application-questions">‚ùì Application Questions <span class="badge">{{ application_questions|length }}</span></a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="{% url 'core:products_list' %}">View All Products</a></li>
    <li><a href="{% url 'core:employee_contact_list' %}">Employee Directory</a></li>
    <li><a href="{% url 'core:cover_list' %}">Coverage Management</a></li>
    <li><a href="{% url 'core:parameter_list' %}">View All Parameters</a></li>
    <li><a href="{% url 'core:document_list' %}">View All Documents</a></li>
    <li><a href="{% url 'core:task_list' %}">View All Tasks</a></li>
    <li><a href="{% url 'core:paper_list' %}">View All Papers</a></li>
    <li><a href="{% url 'core:application_list' %}">View All Applications</a></li>
</ul>
{% endblock %}

{% block page_title %}Enterprise Catalog{% endblock %}
{% block page_subtitle %}Complete directory of ventures, products, employees, and business resources{% endblock %}

{% block content %}
{{ block.super }}

<!-- Enhanced Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ ventures|length }}</div>
        <div>Active Ventures</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ products|length }}</div>
        <div>Products</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ employee_contacts|length }}</div>
        <div>Employees</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ drives|length }}</div>
        <div>Storage Drives</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ coverage_types|length }}</div>
        <div>Coverage Types</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ employee_functions|length }}</div>
        <div>Job Functions</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ papers|length }}</div>
        <div>Papers</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ paper_details|length }}</div>
        <div>Paper Details</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ applications|length }}</div>
        <div>Applications</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ application_questions|length }}</div>
        <div>App Questions</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ parameters|length }}</div>
        <div>Parameters</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ parameter_maps|length }}</div>
        <div>Parameter Maps</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ documents|length }}</div>
        <div>Documents</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ tasks|length }}</div>
        <div>Tasks</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ workflows|length }}</div>
        <div>Workflows</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ workflow_details|length }}</div>
        <div>Workflow Details</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ attachments|length }}</div>
        <div>Attachments</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ attachment_details|length }}</div>
        <div>Attachment Details</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ limits|length }}</div>
        <div>Limits</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ retentions|length }}</div>
        <div>Retentions</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ sublimits|length }}</div>
        <div>Sublimits</div>
    </div>
</div>

<!-- Enhanced Search Bar -->
<div class="card">
    <h3>üîç Search Across All Catalog Items</h3>
    <input type="text" id="globalSearch" placeholder="Search ventures, products, employees, coverage..." style="width: 400px; padding: 10px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px;">
    <button class="btn" onclick="performGlobalSearch()">Search</button>
    <button class="btn btn-secondary" onclick="clearSearch()">Clear</button>
</div>

<!-- Ventures Section -->
<div id="ventures" class="card">
    <h2>üè¢ Business Ventures</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:catalog' %}" class="btn">Refresh</a>
        <button class="btn" onclick="alert('Export functionality coming soon')">Export</button>
        <a href="{% url 'core:venture_api' %}" class="btn btn-secondary">API</a>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Venture ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for venture in ventures %}
            <tr>
                <td>{{ venture.venture_id }}</td>
                <td>
                    <strong>{{ venture.venture_name|default:"Unnamed Venture" }}</strong>
                </td>
                <td>
                    {% if venture.venture_city and venture.venture_state %}
                        {{ venture.venture_city }}, {{ venture.venture_state }}
                    {% else %}
                        Not specified
                    {% endif %}
                </td>
                <td>{{ venture.venture_address_1|truncatechars:30|default:"No address" }}</td>
                <td>
                    <span style="color: green;">‚úÖ Active</span>
                </td>
                <td>
                    <a href="#" onclick="alert('View venture {{ venture.venture_id }}')">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <p>No ventures found. Start by adding your first business venture.</p>
                    <button class="btn">Add Venture</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Products Section -->
<div id="products" class="card">
    <h2>üõçÔ∏è Products Catalog</h2>
    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a href="{% url 'core:products_list' %}" class="btn">View All Products</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-edit-modal btn" data-model="products" data-id="add">
                Add New Product
            </button>
            <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
        </div>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Product ID</th>
                    <th>Product Name</th>
                    <th>Code</th>
                    <th>Venture</th>
                    <th>Coverage</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products|slice:":20" %}
                <tr>
                    {% include "core/partials/products_row.html" %}
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <div style="text-align: center; padding: 20px;">
                            <p>No products found. Add products to your catalog.</p>
                            <button class="btn-edit-modal btn" data-model="products" data-id="add">
                                Add First Product
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Showing: {{ products|slice:":20"|length }} of {{ products|length }} products
        {% if products|length > 20 %}
            - <a href="{% url 'core:products_list' %}">View All {{ products|length }}</a>
        {% endif %}
    </p>
</div>

<!-- Coverage Types Section -->
<div id="coverage-types" class="card">
    <h2>üõ°Ô∏è Coverage Types</h2>
    <div style="margin-bottom: 15px;">
        <a href="{% url 'core:cover_list' %}" class="btn">View All Coverage</a>
        <button class="btn" onclick="alert('Add coverage functionality coming soon')">Add Coverage</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Cover ID</th>
                    <th>Coverage Name</th>
                    <th>Associated Product</th>
                    <th>Product Code</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cover in coverage_types %}
                <tr>
                    <td>{{ cover.cover_id }}</td>
                    <td>
                        <a href="{% url 'core:cover_detail' cover.cover_id %}">
                            <strong>{{ cover.cover_name|default:"Unnamed Coverage" }}</strong>
                        </a>
                    </td>
                    <td>
                        {% if cover.product %}
                            <a href="{% url 'core:products_detail' cover.product.products_id %}">
                                {{ cover.product.product_name|default:"Unnamed Product"|truncatechars:25 }}
                            </a>
                        {% else %}
                            <span style="color: #999;">No product</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if cover.product and cover.product.product_code %}
                            <code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px;">{{ cover.product.product_code }}</code>
                        {% else %}
                            <span style="color: #999;">No code</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:cover_detail' cover.cover_id %}">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">
                        <p>No coverage types found. Add coverage types to your catalog.</p>
                        <button class="btn">Add Coverage</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ coverage_types|length }} coverage types
    </p>
</div>

<!-- Employee Contacts Section -->
<div id="employee-contacts" class="card">
    <h2>üë• Employee Directory</h2>
    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a href="{% url 'core:employee_contact_list' %}" class="btn">Full Directory</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-edit-modal btn" data-model="employee-contact" data-id="add">
                Add New Employee
            </button>
            <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
        </div>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Employee ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Location</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employee_contacts|slice:":20" %}
                <tr>
                    {% include "core/partials/employee_contact_catalog_row.html" %}
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">
                        <div style="text-align: center; padding: 20px;">
                            <p>No employee contacts found. Add employees to your directory.</p>
                            <button class="btn-edit-modal btn" data-model="employee-contact" data-id="add">
                                Add First Employee
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Showing: {{ employee_contacts|slice:":20"|length }} of {{ employee_contacts|length }} employees
        {% if employee_contacts|length > 20 %}
            - <a href="{% url 'core:employee_contact_list' %}">View All {{ employee_contacts|length }}</a>
        {% endif %}
    </p>
</div>

<!-- Employee Functions Section -->
<div id="employee-functions" class="card">
    <h2>‚öôÔ∏è Employee Functions</h2>
    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a href="{% url 'core:employee_function_list' %}" class="btn">View All Functions</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-edit-modal btn" data-model="employee-function" data-id="add">
                Add New Function
            </button>
            <button class="btn btn-secondary" onclick="alert('Export functionality coming soon')">Export</button>
        </div>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Function ID</th>
                    <th>Function Name</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for function in employee_functions|slice:":20" %}
                <tr>
                    {% include "core/partials/employee_function_row.html" %}
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">
                        <div style="text-align: center; padding: 20px;">
                            <p>No employee functions found. Add job functions to organize roles.</p>
                            <button class="btn-edit-modal btn" data-model="employee-function" data-id="add">
                                Add First Function
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Showing: {{ employee_functions|slice:":20"|length }} of {{ employee_functions|length }} functions
        {% if employee_functions|length > 20 %}
            - <a href="{% url 'core:employee_function_list' %}">View All {{ employee_functions|length }}</a>
        {% endif %}
    </p>
</div>

<!-- Storage Drives Section -->
<div id="drives" class="card">
    <h2>üíæ Storage Drives</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn" onclick="alert('Storage analysis coming soon')">Analyze</button>
        <button class="btn" onclick="alert('Add drive functionality coming soon')">Add Drive</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Drive ID</th>
                    <th>Drive Name</th>
                    <th>Associated Venture</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for drive in drives %}
                <tr>
                    <td>{{ drive.drive_id }}</td>
                    <td>
                        <strong>{{ drive.drive_name|default:"Unnamed Drive" }}</strong>
                    </td>
                    <td>
                        {% if drive.venture %}
                            <a href="#ventures">{{ drive.venture.venture_name|default:"Unnamed Venture" }}</a>
                        {% else %}
                            No venture assigned
                        {% endif %}
                    </td>
                    <td>Storage</td>
                    <td>
                        <span style="color: green;">‚úÖ Online</span>
                    </td>
                    <td>
                        <a href="#" onclick="alert('Manage drive {{ drive.drive_id }}')">Manage</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No storage drives found. Add drives to organize your data.</p>
                        <button class="btn">Add Drive</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ drives|length }} drives
    </p>
</div>

<!-- Employee Locations Section -->
<div id="employee-locations" class="card">
    <h2>üìç Employee Locations</h2>
    <div style="margin-bottom: 15px;">
        <button class="btn" onclick="alert('Map view coming soon')">View Map</button>
        <button class="btn" onclick="alert('Add location functionality coming soon')">Add Location</button>
    </div>
    
    <div style="max-height: 500px; overflow-y: auto;">
        <table>
            <thead>
                <tr>
                    <th>Location ID</th>
                    <th>Location Name</th>
                    <th>Venture</th>
                    <th>City & State</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for location in employee_locations %}
                <tr>
                    <td>{{ location.employee_location_id }}</td>
                    <td>
                        <strong>{{ location.employee_location_name|default:"Unnamed Location" }}</strong>
                    </td>
                    <td>
                        {% if location.venture %}
                            <a href="#ventures">{{ location.venture.venture_name|default:"Unnamed Venture" }}</a>
                        {% else %}
                            No venture assigned
                        {% endif %}
                    </td>
                    <td>
                        {% if location.employee_location_city and location.employee_location_state %}
                            {{ location.employee_location_city }}, {{ location.employee_location_state }}
                        {% else %}
                            Not specified
                        {% endif %}
                    </td>
                    <td>{{ location.employee_location_address_1|truncatechars:30|default:"No address" }}</td>
                    <td>
                        <a href="#" onclick="alert('View location {{ location.employee_location_id }}')">View Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">
                        <p>No employee locations found. Add locations to track workforce distribution.</p>
                        <button class="btn">Add Location</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="text-align: center; margin-top: 15px; color: #666;">
        Total: {{ employee_locations|length }} locations
    </p>
</div>

<script>
// Enhanced search functionality
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) {
        alert('Please enter a search term');
        return;
    }
    
    const allRows = document.querySelectorAll('tbody tr');
    let hasResults = false;
    
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
            // Highlight the section
            const section = row.closest('.card');
            if (section) {
                section.style.border = '2px solid #007bff';
                setTimeout(() => {
                    section.style.border = '1px solid #ddd';
                }, 3000);
            }
        } else {
            row.style.display = 'none';
        }
    });
    
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        clearSearch();
    }
}

function clearSearch() {
    document.getElementById('globalSearch').value = '';
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = '');
    
    // Reset section borders
    document.querySelectorAll('.card').forEach(card => {
        card.style.border = '1px solid #ddd';
    });
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Simple smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
            // Add a brief highlight effect
            target.style.background = '#f0f8ff';
            setTimeout(() => {
                target.style.background = '';
            }, 2000);
        }
    });
});

console.log('Enhanced Catalog loaded with {{ products|length }} products, {{ employee_contacts|length }} employees, {{ coverage_types|length }} coverage types');
</script>
{% endblock %}