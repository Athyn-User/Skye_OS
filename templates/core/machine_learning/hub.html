{% extends "core/base_simple.html" %}

{% block title %}Machine Learning - Skye OS{% endblock %}

{% block sidebar %}
<h3>Machine Learning</h3>
<p>AI models and data processing</p>

<h4>Data Management</h4>
<ul>
    <li><a href="#data-seeds">üìÅ Data Seeds <span class="badge">{{ recent_data_seeds|length }}</span></a></li>
    <li><a href="#generation-logs">üìä Generation Logs <span class="badge">{{ recent_generation_logs|length }}</span></a></li>
</ul>

<h4>Model Operations</h4>
<ul>
    <li><a href="#generation-jobs">‚öôÔ∏è Generation Jobs <span class="badge">{{ recent_generation_jobs|length }}</span></a></li>
    <li><a href="#training-jobs">üéØ Training Jobs <span class="badge">{{ recent_training_jobs|length }}</span></a></li>
    <li><a href="#model-parameters">üîß Parameters <span class="badge">{{ recent_model_parameters|length }}</span></a></li>
</ul>

<h4>Quick Actions</h4>
<ul>
    <li><a href="{% url 'core:data_seed_list' %}">View All Data Seeds</a></li>
    <li><a href="{% url 'core:generation_job_list' %}">Manage Jobs</a></li>
</ul>
{% endblock %}

{% block page_title %}Machine Learning{% endblock %}
{% block page_subtitle %}Manage your AI models, training jobs, data seeds, and generation processes{% endblock %}

{% block content %}
{{ block.super }}

<!-- Stats Overview -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ recent_data_seeds|length }}</div>
        <div>Data Seeds</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ recent_generation_jobs|length }}</div>
        <div>Generation Jobs</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ recent_training_jobs|length }}</div>
        <div>Training Jobs</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ recent_generation_logs|length }}</div>
        <div>Generation Logs</div>
    </div>
</div>

<!-- Data Seeds Section -->
<div id="data-seeds" class="card">
    <h2>üìÅ Data Seeds</h2>
    <a href="{% url 'core:data_seed_list' %}" class="btn">View All</a>
    
    <table>
        <thead>
            <tr>
                <th>Filename</th>
                <th>Product</th>
                <th>Show Seed</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for seed in recent_data_seeds|slice:":5" %}
            <tr>
                <td>
                    <a href="{% url 'core:data_seed_detail' seed.data_seed_id %}">
                        {{ seed.data_seed_filename|default:"Unnamed Data Seed" }}
                    </a>
                </td>
                <td>
                    {% if seed.product %}
                        {{ seed.product.product_name|default:"N/A" }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if seed.show_seed %}
                        ‚úÖ Yes
                    {% else %}
                        ‚ùå No
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'core:data_seed_detail' seed.data_seed_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">
                    <p>No data seeds found. Start by adding your first data seed.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Generation Jobs Section -->
<div id="generation-jobs" class="card">
    <h2>‚öôÔ∏è Generation Jobs</h2>
    <a href="{% url 'core:generation_job_list' %}" class="btn">View All</a>
    
    <table>
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Generator Model</th>
                <th>Product ID</th>
                <th>Data Seed</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in recent_generation_jobs|slice:":5" %}
            <tr>
                <td>
                    <a href="{% url 'core:generation_job_detail' job.generation_job_id %}">
                        {{ job.generation_job_id }}
                    </a>
                </td>
                <td>{{ job.generator_model_id|default:"N/A" }}</td>
                <td>{{ job.product_id|default:"N/A" }}</td>
                <td>{{ job.data_seed_id|truncatechars:15|default:"N/A" }}</td>
                <td>
                    <a href="{% url 'core:generation_job_detail' job.generation_job_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">
                    <p>No generation jobs found.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Generation Logs Section -->
<div id="generation-logs" class="card">
    <h2>üìä Generation Logs</h2>
    <a href="{% url 'core:generation_log_list' %}" class="btn">View All</a>
    
    <table>
        <thead>
            <tr>
                <th>Output ID</th>
                <th>Output File</th>
                <th>Model Code</th>
                <th>Product</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for log in recent_generation_logs|slice:":5" %}
            <tr>
                <td>
                    <a href="{% url 'core:generation_log_detail' log.output_id %}">
                        {{ log.output_id }}
                    </a>
                </td>
                <td>{{ log.output_file_name|truncatechars:25|default:"No filename" }}</td>
                <td>{{ log.model_code|truncatechars:15|default:"N/A" }}</td>
                <td>{{ log.product|truncatechars:20|default:"N/A" }}</td>
                <td>
                    <a href="{% url 'core:generation_log_detail' log.output_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">
                    <p>No generation logs found.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Model Parameters Section -->
<div id="model-parameters" class="card">
    <h2>üîß Model Parameters</h2>
    <a href="{% url 'core:model_parameter_list' %}" class="btn">View All</a>
    
    <table>
        <thead>
            <tr>
                <th>Parameter ID</th>
                <th>Training Job</th>
                <th>Parameter</th>
                <th>Input/Output</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for param in recent_model_parameters|slice:":5" %}
            <tr>
                <td>
                    <a href="{% url 'core:model_parameter_detail' param.model_parameter_id %}">
                        {{ param.model_parameter_id }}
                    </a>
                </td>
                <td>
                    {% if param.training_job %}
                        {{ param.training_job.training_job_id }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if param.parameter %}
                        {{ param.parameter.parameter_name|default:param.parameter.parameter_id }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if param.input_output %}
                        {{ param.input_output.input_output_name|default:param.input_output.input_output_id }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'core:model_parameter_detail' param.model_parameter_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">
                    <p>No model parameters found.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Training Jobs Section -->
<div id="training-jobs" class="card">
    <h2>üéØ Training Jobs</h2>
    <a href="{% url 'core:training_job_list' %}" class="btn">View All</a>
    
    <table>
        <thead>
            <tr>
                <th>Job ID</th>
                <th>Pickle File</th>
                <th>Training Model</th>
                <th>Product</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in recent_training_jobs|slice:":5" %}
            <tr>
                <td>
                    <a href="{% url 'core:training_job_detail' job.training_job_id %}">
                        {{ job.training_job_id }}
                    </a>
                </td>
                <td>{{ job.pickle_file_name|truncatechars:20|default:"No filename" }}</td>
                <td>
                    {% if job.training_model %}
                        {{ job.training_model.model_name|default:job.training_model.training_model_id|truncatechars:20 }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if job.products %}
                        {{ job.products.product_name|default:job.products.products_id|truncatechars:20 }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'core:training_job_detail' job.training_job_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">
                    <p>No training jobs found.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
// Simple smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
        }
    });
});
</script>
{% endblock %}