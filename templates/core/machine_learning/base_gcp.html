{% extends "core/base_gcp.html" %}

{% block title %}Skye OS - Catalog{% endblock %}

{% block sidebar %}
<div class="sidebar-header">
    <div class="sidebar-title">Catalog</div>
    <div class="sidebar-subtitle">Enterprise data and resources</div>
</div>

<div class="sidebar-section">
    <div class="sidebar-section-title">Infrastructure</div>
    <a href="#ventures" class="sidebar-item active">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
        </span>
        Ventures
        <span class="badge">{{ ventures|length }}</span>
    </a>
    <a href="#drives" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/>
            </svg>
        </span>
        Storage Drives
        <span class="badge">{{ drives|length }}</span>
    </a>
    <a href="#employee-locations" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
        </span>
        Employee Locations
        <span class="badge">{{ employee_locations|length }}</span>
    </a>
</div>

<div class="sidebar-section">
    <div class="sidebar-section-title">Management</div>
    <a href="{% url 'core:machine_learning' %}" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
        </span>
        Machine Learning
    </a>
    <a href="#" onclick="alert('Coming soon')" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/>
            </svg>
        </span>
        Reports
    </a>
    <a href="#" onclick="alert('Coming soon')" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
        </span>
        Analytics
    </a>
</div>

<div class="sidebar-section">
    <div class="sidebar-section-title">Quick Actions</div>
    <a href="#ventures" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
        </span>
        Add New Venture
    </a>
    <a href="#drives" class="sidebar-item">
        <span class="icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/>
            </svg>
        </span>
        Manage Storage
    </a>
</div>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'core:dashboard' %}">Home</a>
    <span class="separator">/</span>
    <span>Catalog</span>
</div>
{% endblock %}

{% block page_title %}Enterprise Catalog{% endblock %}
{% block page_subtitle %}Manage your ventures, storage drives, and employee locations across the organization{% endblock %}

{% block content %}
{{ block.super }}

<!-- Stats Overview -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
        </div>
        <div class="stat-number">{{ ventures|length }}</div>
        <div class="stat-label">Active Ventures</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/>
            </svg>
        </div>
        <div class="stat-number">{{ drives|length }}</div>
        <div class="stat-label">Storage Drives</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
        </div>
        <div class="stat-number">{{ employee_locations|length }}</div>
        <div class="stat-label">Employee Locations</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">🚀</div>
        <div class="stat-number">100%</div>
        <div class="stat-label">System Health</div>
    </div>
</div>

<!-- Search Bar -->
<div class="search-container">
    <input type="text" class="search-input" placeholder="Search across all catalog items..." id="globalSearch">
    <button class="btn" onclick="performGlobalSearch()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        Search
    </button>
</div>

<!-- Ventures Section -->
<section id="ventures" class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
            </span>
            Business Ventures
        </div>
        <div class="card-actions">
            <button class="btn" onclick="exportVentures()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z"/>
                </svg>
                Export
            </button>
            <button class="btn btn-primary" onclick="addNewVenture()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Add Venture
            </button>
        </div>
    </div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Venture ID</th>
                <th>Name</th>
                <th>Location</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for venture in ventures %}
            <tr>
                <td>
                    <span class="code-snippet">{{ venture.venture_id }}</span>
                </td>
                <td>
                    <div class="flex items-center">
                        <div class="stat-icon" style="width: 24px; height: 24px; margin-right: 12px; font-size: 14px;">🏢</div>
                        <strong>{{ venture.venture_name|default:"Unnamed Venture" }}</strong>
                    </div>
                </td>
                <td>
                    {% if venture.venture_city and venture.venture_state %}
                        <span class="text-primary">{{ venture.venture_city }}, {{ venture.venture_state }}</span>
                    {% else %}
                        <span class="text-muted">Location not specified</span>
                    {% endif %}
                </td>
                <td>
                    {% if venture.venture_address_1 %}
                        <span class="text-muted">{{ venture.venture_address_1|truncatechars:30 }}</span>
                    {% else %}
                        <span class="text-muted">No address</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-badge status-active">Active</span>
                </td>
                <td>
                    <a href="#" class="table-link" onclick="viewVenture({{ venture.venture_id }})">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <div class="empty-state-icon">🏢</div>
                        <h3>No ventures found</h3>
                        <p>Start by adding your first business venture to the catalog.</p>
                        <button class="btn btn-primary" onclick="addNewVenture()">Add Venture</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<!-- Storage Drives Section -->
<section id="drives" class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h8c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/>
                </svg>
            </span>
            Storage Drives
        </div>
        <div class="card-actions">
            <button class="btn" onclick="analyzeStorage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
                Analyze
            </button>
            <button class="btn btn-primary" onclick="addNewDrive()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Add Drive
            </button>
        </div>
    </div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Drive ID</th>
                <th>Drive Name</th>
                <th>Associated Venture</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for drive in drives %}
            <tr>
                <td>
                    <span class="code-snippet">{{ drive.drive_id }}</span>
                </td>
                <td>
                    <div class="flex items-center">
                        <div class="stat-icon" style="width: 24px; height: 24px; margin-right: 12px; font-size: 14px;">💾</div>
                        <strong>{{ drive.drive_name|default:"Unnamed Drive" }}</strong>
                    </div>
                </td>
                <td>
                    {% if drive.venture %}
                        <a href="#ventures" class="table-link">{{ drive.venture.venture_name|default:"Unnamed Venture" }}</a>
                    {% else %}
                        <span class="text-muted">No venture assigned</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-badge status-neutral">Storage</span>
                </td>
                <td>
                    <span class="status-badge status-active">Online</span>
                </td>
                <td>
                    <a href="#" class="table-link" onclick="viewDrive({{ drive.drive_id }})">Manage</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <div class="empty-state-icon">💾</div>
                        <h3>No storage drives found</h3>
                        <p>Add storage drives to organize your venture data.</p>
                        <button class="btn btn-primary" onclick="addNewDrive()">Add Drive</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<!-- Employee Locations Section -->
<section id="employee-locations" class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
            </span>
            Employee Locations
        </div>
        <div class="card-actions">
            <button class="btn" onclick="viewLocationMap()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                View Map
            </button>
            <button class="btn btn-primary" onclick="addNewLocation()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Add Location
            </button>
        </div>
    </div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Location ID</th>
                <th>Location Name</th>
                <th>Venture</th>
                <th>City & State</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for location in employee_locations %}
            <tr>
                <td>
                    <span class="code-snippet">{{ location.employee_location_id }}</span>
                </td>
                <td>
                    <div class="flex items-center">
                        <div class="stat-icon" style="width: 24px; height: 24px; margin-right: 12px; font-size: 14px;">🏢</div>
                        <strong>{{ location.employee_location_name|default:"Unnamed Location" }}</strong>
                    </div>
                </td>
                <td>
                    {% if location.venture %}
                        <a href="#ventures" class="table-link">{{ location.venture.venture_name|default:"Unnamed Venture" }}</a>
                    {% else %}
                        <span class="text-muted">No venture assigned</span>
                    {% endif %}
                </td>
                <td>
                    {% if location.employee_location_city and location.employee_location_state %}
                        <span class="text-primary">{{ location.employee_location_city }}, {{ location.employee_location_state }}</span>
                    {% else %}
                        <span class="text-muted">Location not specified</span>
                    {% endif %}
                </td>
                <td>
                    {% if location.employee_location_address_1 %}
                        <span class="text-muted">{{ location.employee_location_address_1|truncatechars:30 }}</span>
                    {% else %}
                        <span class="text-muted">No address</span>
                    {% endif %}
                </td>
                <td>
                    <a href="#" class="table-link" onclick="viewLocation({{ location.employee_location_id }})">View Details</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <div class="empty-state-icon">🏢</div>
                        <h3>No employee locations found</h3>
                        <p>Add employee locations to track your workforce distribution.</p>
                        <button class="btn btn-primary" onclick="addNewLocation()">Add Location</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}

{% block extra_js %}
// Global search functionality
function performGlobalSearch() {
    const query = document.getElementById('globalSearch').value.toLowerCase();
    if (!query) return;
    
    // Hide all rows first
    const allRows = document.querySelectorAll('tbody tr');
    allRows.forEach(row => row.style.display = 'none');
    
    // Show matching rows
    let hasResults = false;
    allRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
            row.style.display = '';
            hasResults = true;
        }
    });
    
    // Show no results message if needed
    if (!hasResults) {
        alert('No results found for "' + query + '"');
        // Reset display
        allRows.forEach(row => row.style.display = '');
    }
}

// Action handlers
function addNewVenture() {
    alert('Add New Venture functionality coming soon');
}

function addNewDrive() {
    alert('Add New Drive functionality coming soon');
}

function addNewLocation() {
    alert('Add New Location functionality coming soon');
}

function viewVenture(id) {
    alert('Viewing venture details for ID: ' + id);
}

function viewDrive(id) {
    alert('Managing drive with ID: ' + id);
}

function viewLocation(id) {
    alert('Viewing location details for ID: ' + id);
}

function exportVentures() {
    alert('Export functionality coming soon');
}

function analyzeStorage() {
    alert('Storage analysis functionality coming soon');
}

function viewLocationMap() {
    alert('Location map functionality coming soon');
}

// Enter key search
document.getElementById('globalSearch').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performGlobalSearch();
    }
});

// Update active section on scroll
window.addEventListener('scroll', () => {
    const sections = document.querySelectorAll('.card[id]');
    const sidebarItems = document.querySelectorAll('.sidebar-item[href^="#"]');
    
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop - 100;
        if (window.scrollY >= sectionTop) {
            current = section.getAttribute('id');
        }
    });
    
    sidebarItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('href') === `#${current}`) {
            item.classList.add('active');
        }
    });
});
{% endblock %}